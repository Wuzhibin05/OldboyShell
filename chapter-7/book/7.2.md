# 7.2 if 条件语句企业案例精讲



## 7.2.1 监控web和数据库案例



#### 7-4  if 监控nginx web或者mysql数据库是否正常运行

##### （1）分析问题

![image-20210126194949244](images/image-20210126194949244.png)

##### （2）监控mysql数据库异常

- 查看进程

```shell
[root@cdyf150 ~]# netstat -lntup| grep mysql
tcp6       0      0 :::3306                 :::*                    LISTEN      1586/mysqld 
```

- 查看服务是否正常

```shell
[root@cdyf150 ~]# netstat -lnt|grep 3306|awk -F "[ :]+" '{print $4}'
3306
```

```shell
[root@cdyf150 ~]# netstat -lntup| grep mysql|wc l
wc: l: No such file or directory
[root@cdyf150 ~]# netstat -lntup| grep mysql|wc -l
1
[root@cdyf150 ~]# netstat -lntup| grep 3306|wc -l
1
[root@cdyf150 ~]# lsof -i tcp:3306|wc -l
1
```



- 监控端口  telnet nmap nc 

`yum install -y   telnet nmap nc`

```shell
[root@cdyf138 7]# nmap 192.168.8.150 -p 3306|grep open|wc -l
1
[root@cdyf138 7]# echo -e "\n"|telnet 192.168.8.150 3306 2>/dev/null|grep Connected|wc -l
1
[root@cdyf138 7]# nc -w 2 192.168.8.150 3306 $>/dev/null
[root@cdyf150 ~]# ps -ef|grep mysql|grep -v grep|wc -l
1
```

- 监控网站

```shell
[root@cdyf138 7]# wget --spider --timeout=10 --tries=2 www.baidu.com
Spider mode enabled. Check if remote file exists.
--2021-01-26 20:19:48--  http://www.baidu.com/
Resolving www.baidu.com (www.baidu.com)... 14.215.177.39, 14.215.177.38
Connecting to www.baidu.com (www.baidu.com)|14.215.177.39|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 2381 (2.3K) [text/html]
Remote file exists and could contain further links,
but recursion is disabled -- not retrieving.
```

```shell
[root@cdyf138 7]# curl -s -o /dev/null http://www.baidu.com
[root@cdyf138 7]# echo $?
0
```

```shell
[root@cdyf138 7]# wget -T 10 -q --spider http://www.baidu.com  >&/dev/null
[root@cdyf138 7]# echo $?
0
```



##### (3)开发mysql监控脚本

- 脚本1

```shell
echo " monitor msyql-1----------"
if [ `netstat -lnt|grep 3306|awk -F "[ :]+" '{print $4}'` -eq 3306 ];then
  echo "Service mysql is up"
  exit 0
else
  echo "Service mysql is down"
  exit 1
fi
```



##### (4) 监控nginx web

```shell
[root@cdyf137 /]# curl http://192.168.8.137
<html>
<head><title>Index of /</title></head>
<body>
<h1>Index of /</h1><hr><pre><a href="../">../</a>
<a href="docker/">docker/</a>                                            20-Jan-2021 14:25                   -
<a href="elastic/">elastic/</a>                                           20-Jan-2021 14:25                   -
<a href="jdk/">jdk/</a>                                               20-Jan-2021 14:25                   -
<a href="maven/">maven/</a>                                             20-Jan-2021 14:26                   -
<a href="nodejs/">nodejs/</a>                                            20-Jan-2021 14:26                   -
<a href="rabbitmq/">rabbitmq/</a>                                          20-Jan-2021 14:26                   -
<a href="redis/">redis/</a>                                             20-Jan-2021 14:26                   -
<a href="tomcat/">tomcat/</a>                                            20-Jan-2021 14:26                   -
</pre><hr></body>
</html>
```



- 命令行

```shell
[root@cdyf137 /]# ps -ef |grep nginx|grep -v grep|wc -l
5

```

- 脚本

```shell
#!/bin/bash
echo http method 1-----------------
if [[ `netstat -lnt|grep 80|awk -F "[ :]+" '{print $5}'` -eq 80 ]];then
  echo "Nginx is running"
else
  echo "Nginx is stoped"
  systemctl start nginx
fi
```



## 7.2.2 比较大小的经典案例



#### 7-5 使用if比较两个证书大小，使用传参，对传入参数是否为整数进行判断

```shell
#!/bin/bash
# Author: wuzb
# Email: wuzhibin05@163.com
# Date: 2021/01/26 20:47:14
# Version: 1.0
# Description: compare

a=$1
b=$2

if [ $# -ne 2 ];then
  echo "USAGE $0 arg1 arg2"
  exit 2
fi

expr $a + 1 &>/dev/null
RETAL1=$?
expr $b + 1 &>/dev/null
RETAL2=$?

if [ $RETAL1 -ne 0 -a $RETAL2 -ne 0 ];then
  echo "please input two num again."
  exit 1
fi

if [ $a -gt $b ]
  then
    echo " $a is greater than $b."
    exit 0
fi
if [ $a -lt $b ] 
  then
    echo " $a is less than $b."
    exit 0
fi
if [ $a -eq $b ]
  then
    echo " $a is equal $b."
    exit 0
fi
```



## 7.2.3 判断字符串是否为数字的多种思路

#### 7-6 判断字符串是否为数字的多种思路

- sed 正则表达式

